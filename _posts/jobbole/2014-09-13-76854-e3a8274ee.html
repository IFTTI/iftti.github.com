---
layout: post
title: 'Git工作流指南：Pull Request工作流'
time: 2014-09-13 00:00:00 +0800
site_name: jobbole.com
source_url: http://blog.jobbole.com/76854/
images:
  822e73cdf5fe94dec603412fefcbaab0: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-bitbucket.png
  6ac669e0c773553a2e4486a4811a36e3: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-overview.png
  06f1386bbe797449b4e92a8399a65ad9: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-anatomy.png
  25b8a8f9f99c288f204238b3ec94458b: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-feature-branch.png
  3d4db46949437e7ee973b10940c60d78: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/gitflow-workflow-pull-request.png
  3b5756a74b7ccf1356c1e72d16124be1: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-forking-workflow-1.png
  bf9f6dc2a86fa5650fae825e647880a8: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-forking-workflow-2.png
  a1ea21b78cc96b4465d0fab7ac7646dd: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-1.png
  05dc6ac30cc935664e7addd9b4b0788e: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-2.png
  c54ea7abdc1dc6358b7a128e72280b99: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-3.png
  12b695c7a96a473935de97869bcb00f5: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-4.png
  9bac817bc7fc7e67101d2add206ed6f9: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-5.png
  cffce813e014b022ffedf5494c9b8917: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/example-6.png
  b6a90e1e0dc833189d348c7a86a5fcb5: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-7.png
  30b5e47ff1db8daa65351aed0c92016b: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-8.png
  7a4b519888065b3271561f5940a759e1: https://raw.githubusercontent.com/quickhack/translations/master/git-workflows-and-tutorials/images/pull-request-9.png
---
{% raw %}

					
		
<!-- div id="ad1">
<script type="text/javascript">
google_ad_client = "ca-pub-7056282119617872";
google_ad_slot = "6645040531";
google_ad_width = 300;
google_ad_height = 250;
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<br/ -->

<p><code>Pull Requests</code>是<code>Bitbucket</code>上方便开发者之间协作的功能。提供了一个用户友好的<code>Web</code>界面，在集成提交的变更到正式项目前可以对变更进行讨论。</p>
<p><img alt="" src="/images/jobbole.com/822e73cdf5fe94dec603412fefcbaab0.jpg"></p>
<p>开发者向团队成员通知功能开发已经完成，<code>Pull Requests</code>是最简单的用法。开发者完成功能开发后，通过<code>Bitbucket</code>账号发起一个<code>Pull Request</code>。这样让涉及这个功能的所有人知道，要去做<code>Code Review</code>和合并到<code>master</code>分支。</p>
<p>但是，<code>Pull Request</code>远不止一个简单的通知，而是为讨论提交的功能的一个专门论坛。如果变更有任何问题，团队成员反馈在<code>Pull Request</code>中，甚至<code>push</code>新的提交微调功能。所有的这些活动都直接跟踪在<code>Pull Request</code>中。</p>
<p><img alt="" src="/images/jobbole.com/6ac669e0c773553a2e4486a4811a36e3.jpg"></p>
<p>相比其它的协作模型，这种分享提交的形式有助于打造一个更流畅的工作流。<code>SVN</code>和<code>Git</code>都能通过一个简单的脚本收到通知邮件；但是，讨论变更时，开发者通常只能去回复邮件。这样做会变得杂乱，尤其还要涉及后面的几个提交时。<code>Pull Requests</code>把所有相关功能整合到一个和<code>Bitbucket</code>仓库界面集成的用户友好<code>Web</code>界面中。</p>
<h3>解析<code>Pull Request</code>
</h3>
<p>当要发起一个<code>Pull Request</code>，你所要做的就是请求（<code>Request</code>）另一个开发者（比如项目的维护者），来<code>pull</code>你仓库中一个分支到他的仓库中。这意味着你要提供4个信息（源仓库、源分支、目的仓库、目的分支），以发起<code>Pull Request</code>。</p>
<p><img alt="" src="/images/jobbole.com/06f1386bbe797449b4e92a8399a65ad9.jpg"></p>
<p>这些值多数<code>Bitbucket</code>都会设置上合适的缺省值。但取决你用的协作工作流，你的团队可能会要指定不同的值。上图显示了一个<code>Pull Request</code>请求合并一个功能分支到正式的<code>master</code>分支上，但可以有多种不同的<code>Pull Request</code>用法。</p>
<h2>工作方式</h2>
<p><code>Pull Request</code>可以和<a href="http://blog.jobbole.com/76857/">功能分支工作流</a>、<a href="http://blog.jobbole.com/76867/"><code>Gitflow</code>工作流</a>或<a href="http://blog.jobbole.com/76861/"><code>Forking</code>工作流</a>一起使用。但<code>Pull Request</code>要求要么分支不同，要么仓库不同，所以不能用于<a href="http://blog.jobbole.com/76847/">集中式工作流</a>。在不同的工作流中使用<code>Pull Request</code>会有一些不同，但基本的过程是这样的：</p>
<ol>
<li>开发者在本地仓库中新建一个专门的分支开发功能。</li>
<li>开发者<code>push</code>分支修改到公开的<code>Bitbucket</code>仓库中。</li>
<li>开发者通过<code>Bitbucket</code>发起一个<code>Pull Request</code>。</li>
<li>团队的其它成员<code>review</code> <code>code</code>，讨论并修改。</li>
<li>项目维护者合并功能到官方仓库中并关闭<code>Pull Request</code>。</li>
</ol>
<p>本文后面内容说明，<code>Pull Request</code>在不同协作工作流中如何应用。</p>
<h3>在功能分支工作流中使用<code>Pull Request</code>
</h3>
<p>功能分支工作流用一个共享的<code>Bitbucket</code>仓库来管理协作，开发者在专门的分支上开发功能。但不是立即合并到<code>master</code>分支上，而是在合并到主代码库之前开发者应该开一个<code>Pull Request</code>发起功能的讨论。</p>
<p><img alt="" src="/images/jobbole.com/25b8a8f9f99c288f204238b3ec94458b.jpg"></p>
<p>功能分支工作流只有一个公开的仓库，所以<code>Pull Request</code>的目的仓库和源仓库总是同一个。通常开发者会指定他的功能分支作为源分支，<code>master</code>分支作为目的分支。</p>
<p>收到<code>Pull Request</code>后，项目维护者要决定如何做。如果功能没问题，就简单地合并到<code>master</code>分支，关闭<code>Pull Request</code>。但如果提交的变更有问题，他可以在<code>Pull Request</code>中反馈。之后新加的提交也会评论之后接着显示出来。</p>
<p>在功能还没有完全开发完的时候，也可能发起一个<code>Pull Request</code>。比如开发者在实现某个需求时碰到了麻烦，他可以发一个包含正在进行中工作的<code>Pull Request</code>。其它的开发者可以在<code>Pull Request</code>提供建议，或者甚至直接添加提交来解决问题。</p>
<h3>在<code>Gitflow</code>工作流中使用<code>Pull Request</code>
</h3>
<p><code>Gitflow</code>工作流和功能分支工作流类似，但围绕项目发布定义一个严格的分支模型。在<code>Gitflow</code>工作流中使用<code>Pull Request</code>让开发者在发布分支或是维护分支上工作时，可以有个方便的地方对关于发布分支或是维护分支的问题进行交流。</p>
<p><img alt="" src="/images/jobbole.com/3d4db46949437e7ee973b10940c60d78.jpg"></p>
<p><code>Gitflow</code>工作流中<code>Pull Request</code>的使用过程和上一节中完全一致：当一个功能、发布或是热修复分支需要<code>Review</code>时，开发者简单发起一个<code>Pull Request</code>，团队的其它成员会通过<code>Bitbucket</code>收到通知。</p>
<p>新功能一般合并到<code>develop</code>分支，而发布和热修复则要同时合并到<code>develop</code>分支和<code>master</code>分支上。<code>Pull Request</code>可能用做所有合并的正式管理。</p>
<h3>在<code>Forking</code>工作流中使用<code>Pull Request</code>
</h3>
<p>在<code>Forking</code>工作流中，开发者<code>push</code>完成的功能到他自己的仓库中，而不是共享仓库。然后，他发起一个<code>Pull Request</code>，让项目维护者知道他的功能已经可以<code>Review</code>了。</p>
<p>在这个工作流，<code>Pull Request</code>的通知功能非常有用，因为项目维护者不可能知道其它开发者在他们自己的仓库添加了提交。</p>
<p><img alt="" src="/images/jobbole.com/3b5756a74b7ccf1356c1e72d16124be1.jpg"></p>
<p>由于各个开发有自己的公开仓库，<code>Pull Request</code>的源仓库和目标仓库不是同一个。源仓库是开发者的公开仓库，源分支是包含了修改的分支。如果开发者要合并修改到正式代码库中，那么目标仓库是正式仓库，目标分支是<code>master</code>分支。</p>
<p><code>Pull Request</code>也可以用于正式项目之外的其它开发者之间的协作。比如，如果一个开发者和一个团队成员一起开发一个功能，他们可以发起一个<code>Pull Request</code>，用团队成员的<code>Bitbucket</code>仓库作为目标，而不是正式项目的仓库。然后使用相同的功能分支作为源和目标分支。</p>
<p><img alt="" src="/images/jobbole.com/bf9f6dc2a86fa5650fae825e647880a8.jpg"></p>
<p>2个开发者之间可以在<code>Pull Request</code>中讨论和开发功能。完成开发后，他们可以发起另一个<code>Pull Request</code>，请求合并功能到正式的<code>master</code>分支。在<code>Forking</code>工作流中，这样的灵活性让<code>Pull Request</code>成为一个强有力的协作工具。</p>
<h2>示例</h2>
<p>下面的示例演示了<code>Pull Request</code>如何在在<code>Forking</code>工作流中使用。也同样适用于小团队的开发协作和第三方开发者向开源项目的贡献。</p>
<p>在示例中，小红是个开发，小明是项目维护者。他们各自有一个公开的<code>Bitbucket</code>仓库，而小明的仓库包含了正式工程。</p>
<h3>小红<code>fork</code>正式项目</h3>
<p><img alt="" src="/images/jobbole.com/a1ea21b78cc96b4465d0fab7ac7646dd.jpg"></p>
<p>小红先要<code>fork</code>小明的<code>Bitbucket</code>仓库，开始项目的开发。她登陆<code>Bitbucket</code>，浏览到小明的仓库页面，<br>
点<code>Fork</code>按钮。</p>
<p><img alt="" src="/images/jobbole.com/05dc6ac30cc935664e7addd9b4b0788e.jpg"></p>
<p>然后为<code>fork</code>出来的仓库填写名字和描述，这样小红就有了服务端的项目拷贝了。</p>
<h3>小红克隆她的<code>Bitbucket</code>仓库</h3>
<p><img alt="" src="/images/jobbole.com/c54ea7abdc1dc6358b7a128e72280b99.jpg"></p>
<p>下一步，小红克隆自己刚才<code>fork</code>出来的<code>Bitbucket</code>仓库，以在本机上准备出工作拷贝。命令如下：</p>
<p><code>git clone https://user@bitbucket.org/user/repo.git</code></p>
<p>请记住，<code>git clone</code>会自动创建<code>origin</code>远程别名，是指向小红<code>fork</code>出来的仓库。</p>
<h3>小红开发新功能</h3>
<p><img alt="" src="/images/jobbole.com/12b695c7a96a473935de97869bcb00f5.jpg"></p>
<p>在开始改代码前，小红要为新功能先新建一个新分支。她会用这个分支作为<code>Pull Request</code>的源分支。</p>
<p>“`<br>
git checkout -b some-feature</p>
<h1>编辑代码</h1>
<p>git commit -a -m “Add first draft of some feature”<br>
“`</p>
<p>在新功能分支上，小红按需要添加提交。甚至如果小红觉得功能分支上的提交历史太乱了，她可以用<a href="https://www.atlassian.com/git/tutorial/rewriting-git-history#!rebase-i">交互式<code>rebase</code></a>来删除或压制提交。对于大型项目，整理功能分支的历史可以让项目维护者更容易看出在<code>Pull Request</code>中做了什么内容。</p>
<h3>小红<code>push</code>功能到她的<code>Bitbucket</code>仓库中</h3>
<p><img alt="" src="/images/jobbole.com/9bac817bc7fc7e67101d2add206ed6f9.jpg"></p>
<p>小红完成了功能后，<code>push</code>功能到她自己的<code>Bitbucket</code>仓库中（不是正式仓库），用下面简单的命令：</p>
<p><code>git push origin some-branch</code></p>
<p>这时她的变更可以让项目维护者看到了（或者任何想要看的协作者）。</p>
<h3>小红发起<code>Pull Request</code>
</h3>
<p><img alt="" src="/images/jobbole.com/cffce813e014b022ffedf5494c9b8917.jpg"></p>
<p><code>Bitbucket</code>上有了她的功能分支后，小红可以用她的<code>Bitbucket</code>账号浏览到她的<code>fork</code>出来的仓库页面，点右上角的【<code>Pull Request</code>】按钮，发起一个<code>Pull Request</code>。弹出的表单自动设置小红的仓库为源仓库，询问小红以指定源分支、目标仓库和目标分支。</p>
<p>小红想要合并功能到正式仓库，所以源分支是她的功能分支，目标仓库是小明的公开仓库，而目标分支是<code>master</code>分支。另外，小红需要提供<code>Pull Request</code>的标题和描述信息。如果需要小明以外的人审核批准代码，她可以把这些人填在【Reviewers】文本框中。</p>
<p><img alt="" src="/images/jobbole.com/b6a90e1e0dc833189d348c7a86a5fcb5.jpg"></p>
<p>创建好了<code>Pull Request</code>，通知会通过<code>Bitbucket</code>系统消息或邮件（可选）发给小明。</p>
<h3>小明review <code>Pull Request</code>
</h3>
<p><img alt="" src="/images/jobbole.com/30b5e47ff1db8daa65351aed0c92016b.jpg"></p>
<p>在小明的<code>Bitbucket</code>仓库页面的【<code>Pull Request</code>】Tab可以看到所有人发起的<code>Pull Request</code>。点击小红的<code>Pull Request</code>会显示出<code>Pull Request</code>的描述、功能的提交历史和每个变更的差异（<code>diff</code>）。</p>
<p>如果小明想要合并到项目中，只要点一下【<code>Merge</code>】按钮，就可以同意<code>Pull Request</code>并合并到<code>master</code>分支。</p>
<p>但如果像这个示例中一样小明发现了在小红的代码中的一个小<code>Bug</code>，要小红在合并前修复。小明可以在整个<code>Pull Request</code>上加上评注，或是选择历史中的某个提交加上评注。</p>
<p><img alt="" src="/images/jobbole.com/7a4b519888065b3271561f5940a759e1.jpg"></p>
<h3>小红补加提交</h3>
<p>如果小红对反馈有任何疑问，可以在<code>Pull Request</code>中响应，把<code>Pull Request</code>当作是她功能讨论的论坛。</p>
<p>小红在她的功能分支新加提交以解决代码问题，并<code>push</code>到她的<code>Bitbucket</code>仓库中，就像前一轮中的做法一样。这些提交会进入的<code>Pull Request</code>，小明在原来的评注旁边可以再次<code>review</code>变更。</p>
<h3>小明接受<code>Pull Request</code>
</h3>
<p>最终，小明接受变更，合并功能分支到<code>master</code>分支，并关闭<code>Pull Request</code>。至此，功能集成到项目中，其它的项目开发者可以用标准的<code>git pull</code>命令<code>pull</code>这些变更到自己的本地仓库中。</p>
<h2>下一站</h2>
<p>到了这里，你应该有了所有需要的工具来集成<code>Pull Request</code>到你自己的工作流。请记住，<code>Pull Request</code>并不是为了替代任何<a href="http://blog.jobbole.com/76843/">基于<code>Git</code>的协作工作流</a>，而是它们的一个便利的补充，让团队成员间的协作更轻松方便。</p>
<hr>
<p><a href="http://blog.jobbole.com/76861/">« <code>Forking</code>工作流</a>　　　　<a href="http://blog.jobbole.com/76843/">概述 »</a></p>
<p><strong><em>译注</em></strong><br>
<a href="http://weibo.com/oldratlee">自己</a>理解粗浅，译文源码在<a href="https://github.com/quickhack/translations/tree/master/git-workflows-and-tutorials"><code>GitHub</code>上</a>，翻译中不足和不对之处，欢迎建议（<a href="https://github.com/quickhack/translations/issues">提交Issue</a>）和指正（<a href="https://github.com/quickhack/translations/fork">Fork后提交代码</a>）！</p>


<!-- div id="ad1">
</div -->


	


	
{% endraw %}
