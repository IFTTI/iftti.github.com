---
layout: post
title: '天气又转热了，我给她做了个智能小风扇'
time: 2014-10-08 00:00:00 +0800
site_name: jobbole.com
source_url: http://blog.jobbole.com/77963/
images:
  d673736d0c3e882bf1a32c04b438ab95: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdw8f1rj20ac0b2gm1.jpg
  243a5813c1205aa9d364cde7c78d7c69: http://ww4.sinaimg.cn/mw690/6941baebgw1el3kdwozyzj20kh0g3gno.jpg
  293d9805a60e604cbd491b0059ce0594: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdxakvzj20e70e778j.jpg
  4360f0f54dfbaa77a52cb8e4ada951a7: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdxphufj20f70at0u2.jpg
  cdb4e5769b7ef86b8514fc22602a1c31: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdy6bucj20g40c8aav.jpg
  c4f946daa5cce96a2a10cb9849e20273: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdynaolj20jk0j6tbl.jpg
  dc5203fe4034fcc536b8f0d9ebfdf6e5: http://ww2.sinaimg.cn/mw690/6941baebgw1el3kdzngn2j20u01hcwkn.jpg
  dc404baea36c60455963b4108bb893cd: http://ww1.sinaimg.cn/mw690/6941baebgw1el3ke06f63j20fa098q3e.jpg
  8932efb2dd9d88e44fd3d72ce3192922: http://ww1.sinaimg.cn/mw690/6941baebgw1el3ke128l1j20q00ep0vq.jpg
---
{% raw %}

					
		
<!-- div id="ad1">
<script type="text/javascript">
google_ad_client = "ca-pub-7056282119617872";
google_ad_slot = "6645040531";
google_ad_width = 300;
google_ad_height = 250;
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<br/ -->

<pre class="brush: text; gutter: true">黄花深巷，
红叶低窗，
凄凉一片秋声。
豆雨声来，
中间夹带风声。
疏疏二十五点，
丽谯门、不锁更声。
故人远，
问谁摇玉佩，
檐底铃声。
彩角声吹月堕，
渐连营马动，
四起笳声。
闪烁邻灯，
灯前尚有砧声。
知他诉愁到晓，
碎哝哝、多少蛩声。
诉未了，把一半、分与雁声。</pre>
<p>一首短诗《声声慢 秋声》献与大家。蒋捷的这首短诗共96字，其中有十个“声”字；其通过风声、雨声、更声、铃声、笳声、砧声、蛩声、雁声来形容秋天的到来，颇有节奏感。</p>
<p>一直颇喜欢古典诗词，怎奈天赋不佳，至今连完整的四言诗都木写出来过……哎……不提伤心往事了……五音不全不能阻止我喜爱音乐，不能作诗亦不能阻止我爱诗哒！！记得小时候在乡间，对四季的变化非常敏锐，树枝张新芽了，知春来了；知了叫了，知夏来了，树叶黄了，知秋来了；雪花飘了，知深冬了。如今，生活在钢筋水泥之间，对季节的感觉淡漠了，似乎是麻木了，唯一触发人知觉的只有温度，冷了暖气，热了风扇/空调；对于季节的感受全然变了被遗弃的孩子，尽管它在冬天里猛力的哭号，也没有多少人能听见……向往古人感受季节的敏锐……</p>
<p>……</p>
<p>我这是说哪去了呢……哎……情不自禁啊……大家谅解……</p>
<p>话说，长沙天气的热是出了名的，四大火炉之一啊！只是今年天气有点异常，只有在7月热了一小段时间，后面一直是清凉气爽的天！！！在这样的天气下，舒服地过了几个月后（咱家席子都换成被子了），现在又突然变热，大家都有点不适应，GF表现得尤为突出。坐一会就焦躁不安地站起来，说热死了，热死了，显得燥热难耐的样子（她本身散热面积就挺大，不知为啥比我还热……）。好吧，那就开风扇吧，可没吹多久，又说这风吹着不舒服，风大了点还冷。额……，这可是开得最小档啊！为了让GF乖乖的做在我旁边陪我写代码（当然她可以用手机玩游戏），我试着用技术来解决这个问题……</p>
<p>学技术，去哪里，当然是山东蓝翔啊，哈哈……开个玩笑，最近关于蓝翔的段子还真不少，咱就不跟这个风了。 咱可是程序员，用一现有技术拼凑（高大上的说法是集成）就能解决问题好不。下面就说说我要做的智能风扇的功能吧：</p>
<p>1、  风速无级调节</p>
<p>2、  手机控制风扇开关及风速</p>
<p>3、  语音控制风扇开关及风速（能够根据语义进行智能控制）</p>
<p>4、  通过检测皮肤的温湿度控制风扇开关及风速（手环啊）</p>
<p>要做的功能确定了，那就设计方案和准备材料吧。</p>
<p><strong>硬件</strong></p>
<p>1、风扇</p>
<p><img alt="" src="/images/jobbole.com/d673736d0c3e882bf1a32c04b438ab95.jpg"></p>
<p>7寸大号丝雨usb电风扇，用着好用就帮人家推荐下（塑料的，轻，便宜），这是我做人的原则</p>
<p>2、主控板</p>
<p><img alt="" src="/images/jobbole.com/243a5813c1205aa9d364cde7c78d7c69.jpg"></p>
<p>拿着师弟做的带WiFi功能的Arduino板子，不给钱的，光线暗拍着不好看，其实做的还蛮精致的。</p>
<p><img alt="" src="/images/jobbole.com/293d9805a60e604cbd491b0059ce0594.jpg"></p>
<p> </p>
<p>3、  控制接口电路</p>
<p>通过主控板pwm输出控制电源给风扇供电，用万用板焊接好后如下<br>
<img alt="" src="/images/jobbole.com/4360f0f54dfbaa77a52cb8e4ada951a7.jpg"></p>
<p>3、  手机</p>
<p><img alt="" src="/images/jobbole.com/cdb4e5769b7ef86b8514fc22602a1c31.jpg"></p>
<p>如果配送这个手机的话，风扇应该会被扔掉，所以坚决不用这种档次的手机。</p>
<p> </p>
<p>3、  手环</p>
<p>听说又要变天了，为了在天气变凉前把风扇做出来，这个还是在第二版再做吧。</p>
<p><strong>软件</strong></p>
<p>1、  Arduino IDE编程</p>
<p>是的，控制端的程序我就是用arduino写的，你们就尽情的鄙视我吧。</p>
<p><img alt="" src="/images/jobbole.com/c4f946daa5cce96a2a10cb9849e20273.jpg"></p>
<p>而且关于pwm调节只要这么一条语句就实现了哦。</p>
<pre class="brush: actionscript3; gutter: true">analogWrite( 7 , hp*25 );</pre>
<div></div>
<p>2、  Alljoyn通信</p>
<p>用Alljoyn完全是为了装逼，可以对别人吹牛说，我的风扇里用了最先进的物联网技术，其实用tcp通信就能实现。</p>
<p>主控板端Alljoyn接口代码：</p>
<div></div>
<pre class="brush: actionscript3; gutter: true">static const char* const testInterface[] = {
    "org.alljoyn.sample.ledcontroller",
    "?Flash msec&lt;u",
    "?On",
    "?Off",
    NULL
};</pre>
<p>3、  科大飞讯语音引擎</p>
<p>大家用着都说好，我试了下，果然不错！科大飞讯，中国人都用它。</p>
<p>语音识别关键部分代码：</p>
<div>
<div id="highlighter_280789">
<pre class="brush: actionscript3; gutter: true">private InitListener mInitListener = new InitListener() {

        @Override
        public void onInit(int code) {
            Log.d(TAG, "SpeechRecognizer init() code = " + code);
            if (code == ErrorCode.SUCCESS) {
                findViewById(R.id.isr_recognize).setEnabled(true);
            }
        }
    };

    /**
     * 构建语法监听器。
     */
    private GrammarListener grammarListener = new GrammarListener() {
        @Override
        public void onBuildFinish(String grammarId, SpeechError error) {
            if(error == null){
                String grammarID = new String(grammarId);
                Editor editor = mSharedPreferences.edit();
                if(!TextUtils.isEmpty(grammarId))
                    editor.putString(KEY_GRAMMAR_ABNF_ID, grammarID);
                editor.commit();
                showTip("语法构建成功：" + grammarId);
            }else{
                showTip("语法构建失败,错误码：" + error.getErrorCode());
            }           
        }
    };

    /**
     * 识别监听器。
     */
    private RecognizerListener mRecognizerListener = new RecognizerListener() {

        @Override
        public void onVolumeChanged(int volume) {
            showTip("当前正在说话，音量大小：" + volume);
        }

        @Override
        public void onResult(final RecognizerResult result, boolean isLast) {
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    if (null != result) {
                        Log.d(TAG, "recognizer result：" + result.getResultString());
                        String text = "";
                        if(mEngineType.equals(SpeechConstant.TYPE_CLOUD))
                        {
                            //解析云端结果
                            text = JsonParser.parseGrammarResult(result.getResultString());
                        }else {
                            //解析本地结果
                            text = XmlParser.parseNluResult(result.getResultString());
                        }
                        // 显示
                        //((EditText)findViewById(R.id.isr_text)).setText(text);   

                        //分析识别结果
                        Boolean analyzeRelult = analyzeWords(text);

                        //发送控制指令
                        if(analyzeRelult)
                        {
                            controlFan(mWindLevel);
                        }

                    } else {
                        Log.d(TAG, "recognizer result : null");
                    }   
                    SystemClock.sleep(100);
                    //下一次语音识别
                    Button recognizeButton = (Button)findViewById(R.id.isr_recognize);

                    recognizeButton.performClick();
                }
            });

        }

        @Override
        public void onEndOfSpeech() {
            showTip("结束说话");

        }

        @Override
        public void onBeginOfSpeech() {
            showTip("开始说话");
        }

        @Override
        public void onError(SpeechError error) {
            showTip("onError Code：" + error.getErrorCode());
            SystemClock.sleep(100);
            //下一次语音识别
            Button recognizeButton = (Button)findViewById(R.id.isr_recognize);

            recognizeButton.performClick();
        }

        @Override
        public void onEvent(int eventType, int arg1, int agr2, String msg) {
        }
    };</pre>
</div>
</div>
<p>4、  Android</p>
<p>做出来手机软件界面是这样的</p>
<p><img alt="" src="/images/jobbole.com/dc5203fe4034fcc536b8f0d9ebfdf6e5.jpg"></p>
<p> </p>
<p><strong>结果</strong></p>
<p>我最初想做出来的智能风扇应该是这样的：</p>
<p><img alt="" src="/images/jobbole.com/dc404baea36c60455963b4108bb893cd.jpg"></p>
<p>但事实上做出来却是这样的：</p>
<p><img alt="" src="/images/jobbole.com/8932efb2dd9d88e44fd3d72ce3192922.jpg"></p>
<p>至于具体功能怎么样，我晚点上视频。至于GF用着什么反应，这个……</p>


<!-- div id="ad1">
</div -->


	


	
{% endraw %}
