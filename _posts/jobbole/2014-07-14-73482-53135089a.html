---
layout: post
title: '一站式学习Wireshark（七）：Statistics统计工具功能详解与应用'
time: 2014-07-14 00:00:00 +0800
site_name: jobbole.com
source_url: http://blog.jobbole.com/73482/
images:
  aadb32a48278da7e97e35d6c53a43480: http://ww4.sinaimg.cn/mw690/63918611gw1eic5h3pxjxj20ij05gdgf.jpg
  c678f0c4d509a5f83ae60d02d43414ae: http://ww3.sinaimg.cn/mw690/63918611gw1eic5h46cn2j20im0bzmye.jpg
  4dfb098373d67e9751ae9cf32197dfa3: http://ww4.sinaimg.cn/mw690/63918611gw1eic5h4ni56j20il0avq3j.jpg
  26960ecb8b7d009daac3dcec26b023c2: http://ww2.sinaimg.cn/mw690/63918611gw1eic5h57worj20il05f74v.jpg
  fd250c8be18a6b290bd5ed06915efa9c: http://ww3.sinaimg.cn/mw690/63918611gw1eic5h5olkcj20il093dgy.jpg
  bd6f1f07d4649683896fbad45cda9d06: http://ww3.sinaimg.cn/mw690/63918611gw1eic5h65zzbj20im0650tg.jpg
  eabdf42a7432afe6ac200cdadcaa9d67: http://ww2.sinaimg.cn/mw690/63918611gw1eic5h6m5h1j20im0a5abb.jpg
  439a1e3c42fba8cead8cff27c35e8332: http://ww3.sinaimg.cn/mw690/63918611gw1eic5h6wluxj20ik086ab0.jpg
  8d10d243fac731a5e7c7ac80acd4afe7: http://ww1.sinaimg.cn/mw690/63918611gw1eic5h7cnlxj20il07r0tm.jpg
  bff9e2e66d4e9efc5c49c806b8a8c662: http://ww2.sinaimg.cn/mw690/63918611gw1eic5qvh68gj20go05q75r.jpg
  4437c52b23b33f5460bf08b943bd670f: http://ww2.sinaimg.cn/mw690/63918611gw1eic5ilwszlj20il08kjsb.jpg
  7db911d4df184d7b5745f86a38a7d015: http://ww3.sinaimg.cn/mw690/63918611gw1eic5imidw5j20il08fdgt.jpg
  0755e4198d74eede37aca5c606afa55c: http://ww1.sinaimg.cn/mw690/63918611gw1eic5in5llkj20il0algmu.jpg
  c938a97e3fc13e2119b2099a725c27bd: http://ww3.sinaimg.cn/mw690/63918611gw1eic5inxd00j20im07d0tn.jpg
  0509837aa0e3547e4538b4046a3e0034: http://ww1.sinaimg.cn/mw690/63918611gw1eic5ioqhgcj20go03q0t6.jpg
  5aeba4c17e55cb23ba068c63f270f1d4: http://ww1.sinaimg.cn/mw690/63918611gw1eic5qw0kznj20dw0cstao.jpg
  a189bfc000984c307f1eea30076c527a: http://ww4.sinaimg.cn/mw690/63918611gw1eic5k4yfu6j20go03v0t7.jpg
  6778934bcfad139526d4b8dcd6601407: http://ww4.sinaimg.cn/mw690/63918611gw1eic5qwm1tlj20go0cidhv.jpg
  2cab759a25ea0f261482513445623b3a: http://ww2.sinaimg.cn/mw690/63918611gw1eic5lknkjkj20b40490t4.jpg
  a42f66b3c4f3c6768bc996d087c25336: http://ww4.sinaimg.cn/mw690/63918611gw1eic5ll4eg8j20im073gm7.jpg
  af5c7db6a5230248f9ae47d703bc5e82: http://ww1.sinaimg.cn/mw690/63918611gw1eic5llmt7zj20go03mdg9.jpg
  59a9cbd87223e3b2eba5722beeef8fb7: http://ww4.sinaimg.cn/mw690/63918611gw1eic5qxhe77j20dw0chjt6.jpg
---
{% raw %}

					
		
<!-- div id="ad1">
<script type="text/javascript">
google_ad_client = "ca-pub-7056282119617872";
google_ad_slot = "6645040531";
google_ad_width = 300;
google_ad_height = 250;
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<br/ -->

<p>Wireshark一个强大的功能在于它的统计工具。使用Wireshark的时候，我们有各种类型的工具可供选择，从简单的如显示终端节点和会话到复杂的如Flow和IO图表。本文将介绍基本网络统计工具。包括：捕捉文件摘要（Summary）,捕捉包的层次结构（Protocol Hirarchy）, 会话（Conversations）, 终端节点（Endpoints）, HTTP。</p>
<div>
<h1>更多信息</h1>
</div>
<p><strong>Summary:</strong></p>
<p>从statistics菜单，选择<strong>Summary</strong>：</p>
<p><img alt="" src="/images/jobbole.com/aadb32a48278da7e97e35d6c53a43480.jpg"></p>
<p>如下图的截屏所示，你会看到：</p>
<p>File：</p>
<p>捕捉文件的一般信息，如文件名和路径，长度，等等</p>
<p>Time：</p>
<p>第一个包和最后一个包的时间戳，以及抓包过程持续时间</p>
<p>Capture：</p>
<p>显示文件捕捉于哪一个接口，以及评论窗口</p>
<p><img alt="" src="/images/jobbole.com/c678f0c4d509a5f83ae60d02d43414ae.jpg"></p>
<p>在窗口的较低部分是<strong>Display</strong>窗口，展示抓包文件统计信息的摘要，包括：</p>
<p>捕捉报文的总数与百分比</p>
<p>显示报文的数量（加上过滤条件之后）</p>
<p>标记报文的数量</p>
<p><img alt="" src="/images/jobbole.com/4dfb098373d67e9751ae9cf32197dfa3.jpg"></p>
<p><strong>何时使用：</strong></p>
<p>这一菜单简单收集所有抓包数据，在定义了过滤条件的时候，将呈现过滤后的数据。当想要知道每秒的平均报文数或是字节数时，可以使用此工具。</p>
<p><strong>Protocol Hierarchy:</strong></p>
<p>这一部分阐述如何确知网络运行数据。从statistics菜单，选择<strong>Protocol Hierarchy</strong>。</p>
<p><img alt="" src="/images/jobbole.com/26960ecb8b7d009daac3dcec26b023c2.jpg"></p>
<p>这个窗口现实的是捕捉文件包含的所有协议的树状分支。如下图所示：</p>
<p><img alt="" src="/images/jobbole.com/fd250c8be18a6b290bd5ed06915efa9c.jpg"></p>
<p>Protocol Hierarchy窗口有如下字段：</p>
<p>Protocol：</p>
<p>协议名称</p>
<p>% Packets：</p>
<p>含有该协议的包数目在捕捉文件所有包所占的比例</p>
<p>Packets：</p>
<p>含有该协议的包的数目</p>
<p>Bytes：</p>
<p>含有该协议的字节数</p>
<p>Mbit/s：</p>
<p>抓包时间内的协议带宽</p>
<p>End Packets：</p>
<p>该协议中的包的数目（作为文件中的最高协议层）</p>
<p>End Bytes：</p>
<p>该协议中的字节数（作为文件中的最高协议层）</p>
<p>End Mbit/s：</p>
<p>抓包时间内的协议带宽（作为文件中的最高协议层）</p>
<p><strong>小贴士：</strong></p>
<p>包通常会包含许多协议，有很多协议会在每个包中被统计。End Packets，End Bytes，End Mbit/s列是该层在抓包中作为最后一层协议的统计数据（也就是说，协议处于报文的顶层，并且没有更高层信息了）。例如，没有载荷的TCP报文（例如，SYN报文），这一类没有负载任何上层信息的报文。这就是为什么在Ethernet层，IPv4层和UDP层报文计数为0，因为没有接收到以这些协议作为最后一层的帧。</p>
<p><strong>何时使用：</strong></p>
<p>值得注意的两点是：</p>
<p>百分比永远指的是相同协议层级。例如，</p>
<p><strong>使用要点：</strong></p>
<p>1. Percentage永远参照的是相同协议层。例如，上例中81.03%是IPv4报文，8.85%是IPv6报文，10.12%是ARP报文。第二层之上的各协议所占百分比总和是100%。</p>
<p>2. 另一方面，TCP占总数据的75.70%，在TCP协议之内，只有12.74%的报文是HTTP，除此之外没有其他统计。这是由于Wireshark只统计有HTTP头的报文。它不统计如确认报文或数据报文这样没有HTTP头的报文。</p>
<p>3. 为了使Wireshark同时统计数据报文，例如，TCP报文内部的HTTP报文，关闭<strong>Allow sub-dissector</strong>选项，对TCP数据流重新统计。可在<strong>Preferences</strong>菜单或<strong>Packet Details</strong>面板中右键<strong>TCP</strong>来实现。</p>
<p><strong>Conversations：</strong></p>
<p>1. 在Statistics菜单中，选择<strong>Coversations</strong>。</p>
<p><img alt="" src="/images/jobbole.com/bd6f1f07d4649683896fbad45cda9d06.jpg"></p>
<p>2. 会看到以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/eabdf42a7432afe6ac200cdadcaa9d67.jpg"></p>
<p>3. 可以选择第2层以太网统计数据，第3层IP统计数据，或第4层TCP或UDP统计数据。</p>
<p>4. 可以选择以下统计工具：</p>
<ul>
<li>
<strong>On layer 2(Ethernet)</strong>：查找并过滤广播风暴或</li>
<li>
<strong>On layer 3 or 4(TCP/IP)</strong><strong>：</strong>通过互联网路由器端口并行连接，查看谁在向ISP传输数据</li>
</ul>
<p><strong>小贴士：</strong></p>
<p>如果你看到互联网上某一IP地址通过端口80（HTTP）向外传输大量数据流，你就需要将该地址复制入浏览器并且查看你的用户与哪一个网站通讯最多。</p>
<p>如果没有得到结果，只需到标准DNS查询站点（Google一下DNS lookup）查看哪一种流量占用了你的网线。</p>
<p>5. 也可以通过选择位于窗口左下方的<strong>Limit to display filter</strong>复选框<strong>，</strong>将会话统计信息进行显示过滤。这样，仅呈现所有通过显示过滤条件的统计数据。</p>
<p>6.要查看IP地址对应名称，可以选择<strong>Name resolution</strong>复选框。要查看IP名称解析，进入<strong>View | Name Resolution | Enable for Network layer</strong>进行激活。</p>
<p>7. 对于TCP或UDP，可以在Packet list中对指定报文进行标记，之后从菜单中选择<strong>Follow TCP Stream</strong>或<strong>Follow UDP Stream</strong>。从而定义一个显示过滤条件，仅显示指定数据流。</p>
<p><strong>使用要点：</strong></p>
<p>网络会话是两个指定终端之间的数据流。例如，IP会话是两个IP地址之间的所有数据流，TCP会话包含了所有TCP连接。</p>
<p>通过<strong>Conversations</strong>列表，能看出很多网络问题。</p>
<p>以太网会话统计</p>
<p>在Ethernet conversations statistics中，查找以下问题：</p>
<ul>
<li>大量的广播风暴：可以看见较轻微的广播风暴；而对于每秒数千甚至数万个报文的严重广播风暴，Wireshark会停止显示数据并且屏幕冻结。只有断开Wireshark连接时才能看见。</li>
<li>如果你看到来自某一MAC地址的大量数据，查看会话第一部分的vendor ID，会给你一些导致问题的线索。即使MAC地址的第一部分标识了vendor，但它并不一定就标识了PC本身。这是由于MAC地址属于PC上安装的以太网芯片厂商，而并不一定属于PC制造商。如果无法识别数据流来源地址，可以ping嫌疑地址并通过ARP获取它的MAC地址，在交换机中查找该地址，如果有操作系统的话直接用find命令来定位。</li>
</ul>
<p>IP会话统计</p>
<p>在IP conversations statistics中，查找以下问题：</p>
<ul>
<li>查看收发大量数据流的IP地址。如果是你知道的服务器（你记得服务器的地址或地址范围），那问题就解决了；但也有可能只是某台设备正在扫描网络，或仅是一台产生过多数据的PC。</li>
<li>查看扫描模式（scan pattern）。这可能是一次正常的扫描，如SNMP软件发送ping报文以查找网络，但通常扫描都不是好事情。</li>
<li>一次典型的扫描模式如下图所示：</li>
</ul>
<p><img alt="" src="/images/jobbole.com/439a1e3c42fba8cead8cff27c35e8332.jpg"></p>
<p>本例中的扫描模式，一个IP地址，192.168.110.58，发送ICMP报文至192.170.3.44, 192.170.3.45, 192.170.3.46, 192.170.3.47,等等（上图仅显示扫描的很小一部分）。这种情况下我们有一个蠕虫病毒感染了网络上的所有PC，在它感染PC的时候，它就开始产生ICMP请求并将它们发送至网络。这些窄带连接（例如：WAN连接）可以很容易地被封锁。</p>
<p>TCP/UDP会话统计</p>
<ul>
<li>查看带有太多TCP连接的设备。每一个PC合理的连接数是10到20个，上百个则是不正常的。</li>
<li>尝试查找无法辨识的端口号。它可能是正常的，但也可能是有问题的。下图显示了一次典型的TCP扫描：</li>
</ul>
<p><img alt="" src="/images/jobbole.com/8d10d243fac731a5e7c7ac80acd4afe7.jpg"></p>
<p><strong>Endpoints:</strong></p>
<p><strong>1. </strong>从statistics菜单，选择<strong>Endpoints</strong>：</p>
<p><img alt="" src="/images/jobbole.com/bff9e2e66d4e9efc5c49c806b8a8c662.jpg"></p>
<p>2. 出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/4437c52b23b33f5460bf08b943bd670f.jpg"></p>
<p>3. 此窗口中，能够看到第2,3,4层的endpoints，也就是以太网，IP, TCP或UDP。</p>
<p><strong>使用要点：</strong></p>
<p>这一工具列出了Wireshark发现的所有endpoints上的统计信息。可以是以下任意一种情况：</p>
<ul>
<li>少量以太网endpoints（MAC地址）与大量IP终端节点（IP地址）：可能的情况例如，一个路由器从很多远端设备收发报文，我们会看见路由器的MAC地址及很多IP地址经由此处。</li>
<li>少量IP终端节点与大量TCP终端节点：可能的情况是每一台主机有很多个TCP连接。可能是有很多连接的服务器的一个正常操作，也可能是一种网络攻击（如SYN攻击）。</li>
</ul>
<p>以下是一个网络中心的抓包示例，一个内部网络有四个HP服务器和一个Cisco路由器，MAC地址的第一部分已经解析了厂商名称：</p>
<p><img alt="" src="/images/jobbole.com/7db911d4df184d7b5745f86a38a7d015.jpg"></p>
<p>当我们查看IPv4:191下的endpoints，我们看到有很多来自192.168.10.0, 192.168.30.0，以及其他网络地址。</p>
<p><img alt="" src="/images/jobbole.com/0755e4198d74eede37aca5c606afa55c.jpg"></p>
<p><strong>HTTP:</strong></p>
<p><strong>1. </strong>从statistics菜单，选择<strong>HTTP</strong>，将会出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/c938a97e3fc13e2119b2099a725c27bd.jpg"></p>
<p>在HTTP子菜单中，可以看到以下信息：</p>
<p>Packet Counter：</p>
<p>每一个网站的报文数量。帮助识别有多少响应和请求。</p>
<p>Requests：</p>
<p>各网站的请求分布。</p>
<p>Load Distribution：</p>
<p>各网站的负载分布。</p>
<p>按照以下操作步骤查看<strong>Packet Counter</strong>统计信息：</p>
<p>1. 进入<strong>Statistics | HTTP | Packet Counter。</strong></p>
<p>2. 显示以下过滤窗口：</p>
<p><img alt="" src="/images/jobbole.com/0509837aa0e3547e4538b4046a3e0034.jpg"></p>
<p>3. 此窗口中，可设置过滤条件以查看符合过滤条件的统计信息。如果想要查看整个抓包文件的统计信息，留白不填。这就会显示IP层之上的统计信息，也就是所有HTTP报文。</p>
<p>4. 点击<strong>Create Stat</strong>按钮，会看到以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/5aeba4c17e55cb23ba068c63f270f1d4.jpg"></p>
<p>如果要查看某一特定节点的HTTP统计信息，可以通过display filter的方式配置过滤条件。</p>
<p>按照以下操作步骤查看<strong>HTTP Requests</strong>统计信息：</p>
<p>1. 进入<strong>Statistics | HTTP | Requests，</strong>出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/a189bfc000984c307f1eea30076c527a.jpg"></p>
<p>2. 选择所需过滤条件。对于所有数据，留白。</p>
<p>3. 点击<strong>Create Stat</strong>按钮，会出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/6778934bcfad139526d4b8dcd6601407.jpg"></p>
<p>4. 要获得指定HTTP主机的统计信息，设置过滤条件http.host contains &lt;host_name&gt; 或 http.host==&lt;host_name&gt;。</p>
<p>5. 例如，通过设置过滤条件http.host contains ndi-com.com，可以获得站点 <a href="http://www.ndi-com.com/" target="_blank">www.ndi-com.com</a>的统计信息，如下图所示：</p>
<p><img alt="" src="/images/jobbole.com/2cab759a25ea0f261482513445623b3a.jpg"></p>
<p>6. 结果如下图所示：</p>
<p><img alt="" src="/images/jobbole.com/a42f66b3c4f3c6768bc996d087c25336.jpg"></p>
<p>按照以下操作步骤查看<strong>Load Distribution</strong>统计信息：</p>
<p>1. 进入<strong>Statistics | HTTP | Load Distribution。</strong></p>
<p>2.<strong> </strong>出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/af5c7db6a5230248f9ae47d703bc5e82.jpg"></p>
<p>3. 选择所需过滤条件。对于所有数据，留白。</p>
<p>4. 点击<strong>Create Stat</strong>按钮，会出现以下窗口：</p>
<p><img alt="" src="/images/jobbole.com/59a9cbd87223e3b2eba5722beeef8fb7.jpg"></p>
<p><strong>使用要点：</strong></p>
<p>当我们打开一个网页，通常会向若干个URL发送请求。本例中，我们打开的其中一个网页是<a href="http://www.cnn.xn--com%2Cedition-lx0r784c19zieax92bm2p.cnn.com/" target="_blank">www.cnn.com，并将我们导向edition.cnn.com</a>。我们发送了若干个请求：到root URL，到breaking_news URL，以及主页上两个其他位置。</p>


<!-- div id="ad1">
</div -->

<p><a target="_blank" rel="nofollow" href="http://www.jobdeer.com/?fr=jobbole"></a></p>
	


	
{% endraw %}
