---
layout: post
title: 'From Clouds to Roots: Performance Analysis at Netflix'
time: 2014-09-27 00:00:00 +0800
site_name: brendangregg.com
source_url: http://www.brendangregg.com/blog/2014-09-27/from-clouds-to-roots.html
images:
  8117220f7d1a16ef6a80ac51b34c927f: /blog/images/2014/netflix_cloud_perf_analysis.png
  30cb18d519c569b8273e6a5838904be8: /blog/images/2014/linux_EC2_perf_tools.png
---
{% raw %}

<p>How do companies like Netflix, Google, and Facebook do root cause performance analysis in their cloud environments? These companies use Linux heavily, so are they using SystemTap or another tracer? Netflix is hosted on EC2, how do they do low level CPU profiling, if Xen guests can't access the CPU counters? ... And if these companies don't do these kinds of profiling, aren't they losing millions because of it?</p>

<p>On Thursday it was my privilege to speak again at <a href="http://surge.omniti.com/2014">Surge</a>, the scalability and performance conference. My talk was titled <a href="http://surge.omniti.com/2014/speakers/speakers.html?gregg-brendan%5D">From Clouds to Roots</a>, and showed how Neflix does root cause performance analysis, and answers these questions and more. The slides are on <a href="http://www.slideshare.net/brendangregg/netflix-from-clouds-to-roots">slideshare</a>:</p>

<p></p>
<center>
<iframe src="//www.slideshare.net/slideshow/embed_code/39526755" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> </center>

<p>It was also videoed; I'll update this post when the video is available.</p>

<p>For background, I began by explaining the Netflix fault-tolerant architecture: how this can automatically work around performance issues, and what kinds of new issues this can introduce. Then I summarized key cloud-wide performance tools, and how we use these to isolate issues to an instance. And finally instance analysis, with the low-level tools we run to find the root cause.</p>

<p>Summary of cloud-wide performance tools:</p>

<p></p>
<center><a href="/blog/images/2014/netflix_cloud_perf_analysis.png"><img src="/images/brendangregg.com/8117220f7d1a16ef6a80ac51b34c927f.jpg" width="500"></a></center>

<p>Summary of instance performance tools:</p>

<p></p>
<center><a href="/blog/images/2014/linux_EC2_perf_tools.png"><img src="/images/brendangregg.com/30cb18d519c569b8273e6a5838904be8.jpg" width="500"></a></center>

<p>People liked the talk, although it surprised some. One comment was "it didn't feel like a Brendan talk". Yes, I've expanded my scope at Netflix, and I'm working on higher-level analysis now, not just low-level performance tools. It's exciting for me, and I feel I have a better and more balanced view of performance analysis, which I captured in this talk.</p>

<p>Keep in mind that you aren't necessarily expected to do the low-level performance analysis yourself. I summarized the likely real scenarios at the end of the talk:</p>

<ul>
<li>A. Your company has one or more people who do advanced perf analysis (perf team). Ask them to do it.</li>
<li>B. You actually are that person. Do it.</li>
<li>C. You buy a product that does it. Ask them to add low-level capabilities.</li>
</ul>

<p>Perhaps the most valuable take-away of this talk is that you be aware that such low-level analysis is possible, so that if you are in situation (A) or (C), you can ask for it. I've found that performance monitoring companies often build products based on what customers think they want. However, what customers think they want is bounded by what they know is possible. You really want products that make low-level analysis easy, including flame graphs and latency heat maps. Some monitoring products already provide these (eg, Circonus, AppNeta), and at Netflix we're building Vector.</p>

<p>Last year at Surge, I saw a great talk by <a href="http://twitter.com/coburnw">Coburn Watson</a> titled <a href="http://www.youtube.com/watch?v=7-13wV3WO8Q">How Netflix Maximizes Scalability, Resilience, and Engineering Velocity in the Cloud</a>, which I recommend. His relaxed style threw me at first: he's able to talk very casually about complex performance issues in distributed environments, because he actually understands them extremely well. This year, he's now my manager at Netflix, and he's also still hiring. Great at performance and want to work with both Coburn and myself? Let him <a href="mailto:cwatson@netflix.com">know</a>. :-)</p>

<p>For more about low level performance analysis tools, see my <a href="/blog">previous blog posts</a>, and my <a href="https://github.com/brendangregg/perf-tools">perf-tools</a> and <a href="https://github.com/brendangregg/msr-cloud-tools">msr-cloud-tools</a> collections on github.</p>

{% endraw %}
