<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Spring Batch 在大型企业中的最佳实践</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="[IT技术干货iftti.com] @KernelHacks">
    <link rel="canonical" href="http://iftti.com/posts/2017/2017-01-13-109857-ee1fcbd9c.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>

    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">IT技术干货</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">

          <a class="page-link" href="/about/">About</a>

      </div>
    </nav>

  </div>

</header>

    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Spring Batch 在大型企业中的最佳实践</h1>
    <p class="meta"><span class="time">Jan 13, 2017</span><span class="source_url"> • 来自 jobbole.com <a name="jobbole.com" href="http://blog.jobbole.com/109857/" target="_blank">[原文链接]</a></span></p>
  </header>

  <article class="post-content">

        			<div class="textwidget">
</div>

		<p>在大型企业中，由于业务复杂、数据量大、数据格式不同、数据交互格式繁杂，并非所有的操作都能通过交互界面进行处理。而有一些操作需要定期读取大批量的数据，然后进行一系列的后续处理。这样的过程就是“批处理”。</p>
<p><img src="/images/jobbole.com/ca3bd66122fe7512a89fdfcac747d9fb.jpg" alt="database-schema" width="700" height="611"></p>
<p>批处理应用通常有以下特点：</p>
<ul>
<li>数据量大，从数万到数百万甚至上亿不等；</li>
<li>整个过程全部自动化，并预留一定接口进行自定义配置；</li>
<li>这样的应用通常是周期性运行，比如按日、周、月运行；</li>
<li>对数据处理的准确性要求高，并且需要容错机制、回滚机制、完善的日志监控等。</li>
</ul>
<h3>什么是Spring batch</h3>
<p>Spring batch是一个轻量级的全面的批处理框架，它专为大型企业而设计，帮助开发健壮的批处理应用。Spring batch为处理大批量数据提供了很多必要的可重用功能，比如日志追踪、事务管理、job执行统计、重启job和资源管理等。同时它也提供了优化和分片技术用于实现高性能的批处理任务。</p>
<p>它的核心功能包括：</p>
<ul>
<li>事务管理</li>
<li>基于块的处理过程</li>
<li>声明式的输入/输出操作</li>
<li>启动、终止、重启任务</li>
<li>重试/跳过任务</li>
<li>基于Web的管理员接口</li>
</ul>
<p>笔者所在的部门属于国外某大型金融公司的CRM部门，在日常工作中我们经常需要开发一些批处理应用，对Spring Batch有着丰富的使用经验。近段时间笔者特意总结了这些经验。</p>
<p><a href="http://insights.thoughtworkers.org/wp-content/uploads/2017/01/spring-batch.jpg"><img src="/images/jobbole.com/c621a7d6449fc102c5d52b724d3233a3.jpg" alt="spring batch" width="700" height="400"></a></p>
<h3>使用Spring Batch 3.0以及Spring Boot</h3>
<p>在使用Spring Batch时推荐使用最新的Spring Batch 3.0版本。相比Spring Batch2.2，它做了以下方面的提升：</p>
<ul>
<li>支持JSR-352标准</li>
<li>支持Spring4以及Java8</li>
<li>增强了Spring Batch Integration的功能</li>
<li>支持JobScope</li>
<li>支持SQLite</li>
</ul>
<p>支持Spring4和Java8是一个重大的提升。这样就可以使用Spring4引入的Spring boot组件，从而开发效率方面有了一个质的飞跃。引入Spring-batch框架只需要在build.gradle中加入一行代码即可：</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46529923143549" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
compile("org.springframework.boot:spring-boot-starter-batch")</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-587b100a46529923143549-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-587b100a46529923143549-1">
<span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">"org.springframework.boot:spring-boot-starter-batch"</span><span class="crayon-sy">)</span>
</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>而增强Spring Batch Integration的功能后，我们就可以很方便的和Spring家族的其他组件集成，还可以以多种方式来调用job，也支持远程分区操作以及远程块处理。</p>
<p>而支持JobScope后我们可以随时为对象注入当前Job实例的上下文信息。只要我们指定Bean的scope为job scope，那么就可以随时使用jobParameters和jobExecutionContext等信息。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46533287655388" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@Component
@JobScope
public class CustomClass {

    @Value("#{jobParameters[jobDate]}")
    private String jobDate;

    @Value("#{jobExecutionContext['input.name']}.")
    private String fileName;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46533287655388-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46533287655388-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46533287655388-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46533287655388-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46533287655388-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46533287655388-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46533287655388-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46533287655388-8">8</div>
<div class="crayon-num" data-line="crayon-587b100a46533287655388-9">9</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46533287655388-10">10</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46533287655388-1">
<span class="crayon-sy">@</span><span class="crayon-e">Component</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46533287655388-2">
<span class="crayon-sy">@</span><span class="crayon-e">JobScope</span>
</div>
<div class="crayon-line" id="crayon-587b100a46533287655388-3">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">CustomClass</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46533287655388-4"> </div>
<div class="crayon-line" id="crayon-587b100a46533287655388-5">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Value</span><span class="crayon-sy">(</span><span class="crayon-s">"#{jobParameters[jobDate]}"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46533287655388-6">
<span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">jobDate</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line" id="crayon-587b100a46533287655388-7"> </div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46533287655388-8">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Value</span><span class="crayon-sy">(</span><span class="crayon-s">"#{jobExecutionContext['input.name']}."</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46533287655388-9">
<span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">fileName</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46533287655388-10"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<h3>使用Java Config而不是xml的配置方式</h3>
<p>之前我们在配置job和step的时候都习惯用xml的配置方式，但是随着时间的推移发现问题颇多。</p>
<ul>
<li>xml文件数急剧膨胀，配置块长且复杂，可读性很差；</li>
<li>xml文件缺少语法检查，有些低级错误只有在运行集成测试的时候才能发现；</li>
<li>在xml文件中进行代码跳转时IDE的支持力度不够；</li>
</ul>
<p>我们渐渐发现使用纯Java类的配置方式更灵活，它是类型安全的，而且IDE的支持更好。在构建job或step时采用的流式语法相比xml更加简洁易懂。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46538450832378" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@Bean
public Step step(){
    return stepBuilders.get("step")
        .chunk(1)
        .reader(reader())
        .processor(processor())
        .writer(writer())
        .listener(logProcessListener())
        .faultTolerant()
        .skipLimit(10)
        .skip(UnknownGenderException.class)
        .listener(logSkipListener())
        .build();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46538450832378-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-8">8</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-9">9</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-10">10</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-11">11</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-12">12</div>
<div class="crayon-num" data-line="crayon-587b100a46538450832378-13">13</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46538450832378-14">14</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46538450832378-1">
<span class="crayon-sy">@</span><span class="crayon-e">Bean</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-2">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Step </span><span class="crayon-e">step</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-3">
<span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">stepBuilders</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"step"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-4">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">chunk</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-5">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">reader</span><span class="crayon-sy">(</span><span class="crayon-e">reader</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-6">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">processor</span><span class="crayon-sy">(</span><span class="crayon-e">processor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-7">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">writer</span><span class="crayon-sy">(</span><span class="crayon-e">writer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-8">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">listener</span><span class="crayon-sy">(</span><span class="crayon-e">logProcessListener</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-9">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">faultTolerant</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-10">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">skipLimit</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-11">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">skip</span><span class="crayon-sy">(</span><span class="crayon-v">UnknownGenderException</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-12">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">listener</span><span class="crayon-sy">(</span><span class="crayon-e">logSkipListener</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46538450832378-13">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46538450832378-14"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>在这个例子中可以很清楚的看到该step的配置，比如reader/processor/writer组件，以及配置了哪些listener等。</p>
<h3>本地集成测试中使用内存数据库</h3>
<p>Spring batch在运行时需要数据库支持，因为它需要在数据库中建立一套schema来存储job和step运行的统计信息。而在本地集成测试中我们可以借助Spring batch提供的内存Repository来存储Spring batch的任务执行信息，这样既避免了在本地配置一个数据库，又可以加快job的执行。先为Job的配置类添加扩展类：DefaultBatchConfigurer。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46540504342481" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class CustomJobConfiguration extends DefaultBatchConfigurer {

    ...
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46540504342481-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46540504342481-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46540504342481-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46540504342481-4">4</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46540504342481-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">CustomJobConfiguration</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">DefaultBatchConfigurer</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46540504342481-2"> </div>
<div class="crayon-line" id="crayon-587b100a46540504342481-3">
<span class="crayon-h">    </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46540504342481-4"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>我们在build.gradle中加入对hsqldb的依赖：</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46544937768421" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
runtime(‘org.hsqldb:hsqldb:2.3.2’)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-587b100a46544937768421-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-587b100a46544937768421-1">
<span class="crayon-e">runtime</span><span class="crayon-sy">(</span>‘<span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">hsqldb</span><span class="crayon-o">:</span><span class="crayon-v">hsqldb</span><span class="crayon-o">:</span><span class="crayon-cn">2.3.2</span>’<span class="crayon-sy">)</span>
</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>然后在测试类中添加对DataSource的配置。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46547952726554" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@EnableAutoConfiguration
@EnableBatchProcessing
@DataJpaTest
@Import({DataSourceAutoConfiguration.class, BatchAutoConfiguration.class})
public class TestConfiguration {

}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46547952726554-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46547952726554-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46547952726554-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46547952726554-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46547952726554-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46547952726554-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46547952726554-7">7</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46547952726554-1">
<span class="crayon-sy">@</span><span class="crayon-e">EnableAutoConfiguration</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46547952726554-2">
<span class="crayon-sy">@</span><span class="crayon-e">EnableBatchProcessing</span>
</div>
<div class="crayon-line" id="crayon-587b100a46547952726554-3">
<span class="crayon-sy">@</span><span class="crayon-e">DataJpaTest</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46547952726554-4">
<span class="crayon-sy">@</span><span class="crayon-e">Import</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-v">DataSourceAutoConfiguration</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">BatchAutoConfiguration</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46547952726554-5">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TestConfiguration</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46547952726554-6"> </div>
<div class="crayon-line" id="crayon-587b100a46547952726554-7"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>并且在applicaton.properties配置中添加初始化Database的配置：</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a4654a079024025" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
spring.batch.initializer.enable=true</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-587b100a4654a079024025-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-587b100a4654a079024025-1">
<span class="crayon-v">spring</span><span class="crayon-sy">.</span><span class="crayon-v">batch</span><span class="crayon-sy">.</span><span class="crayon-v">initializer</span><span class="crayon-sy">.</span><span class="crayon-v">enable</span><span class="crayon-o">=</span><span class="crayon-t">true</span>
</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3>合理的使用Chunk机制</h3>
<p>Spring batch在配置Step时采用的是基于Chunk的机制。即每次读取一条数据，再处理一条数据，累积到一定数量后再一次性交给writer进行写入操作。这样可以最大化的优化写入效率，整个事务也是基于Chunk来进行。</p>
<p>当我们在需要将数据写入到文件、数据库中之类的操作时可以适当设置Chunk的值以满足写入效率最大化。但有些场景下我们的写入操作其实是调用一个web service或者将消息发送到某个消息队列中，那么这些场景下我们就需要设置Chunk的值为1，这样既可以及时的处理写入，也不会由于整个Chunk中发生异常后，在重试时出现重复调用服务或者重复发送消息的情况。</p>
<h3>使用Listener来监视job执行情况并及时做相应的处理</h3>
<p>Spring batch提供了大量的Listener来对job的各个执行环节进行全面的监控。</p>
<p>在job层面Spring batch提供了JobExecutionListener接口，其支持在Job开始或结束时进行一些额外处理。在step层面Spring batch提供了StepExecutionListener，ChunkListener，ItemReadListener，ItemProcessListener，ItemWriteListener，SkipListener等接口，同时对Retry和Skip操作也提供了RetryListener及SkipListener。</p>
<p>通常我们会为每个job都实现一个JobExecutionListener，在afterJob操作中我们输出job的执行信息，包括执行时间、job参数、退出代码、执行的step以及每个step的详细信息。这样无论是开发、测试还是运维人员都对整个job的执行情况了如指掌。</p>
<p>如果某个step会发生skip的操作，我们也会为其实现一个SkipListener，并在其中记录skip的数据条目，用于下一步的处理。</p>
<p>实现Listener有两种方式，一种是继承自相应的接口，比如继承JobExecutionListener接口，另一种是使用annoation（注解）的方式。经过实践我们认为使用注解的方式更好一些，因为使用接口你需要实现接口的所有方法，而使用注解则只需要对相应的方法添加annoation即可。</p>
<p>下面的这个类采用了继承接口的方式，我们看到其实我们只用到了第一个方法，第二个和第三个都没有用到。但是我们必须提供一个空的实现。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a4654e314816687" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class CustomSkipListener implements SkipListener {
    @Override
    public void onSkipInRead(Throwable t) {
        // business logic
    }

    @Override
    public void onSkipInWrite(String item, Throwable t) {
        // no need
    }

    @Override
    public void onSkipInProcess(String item, Throwable t) {
        // no need
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-8">8</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-9">9</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-10">10</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-11">11</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-12">12</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-13">13</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-14">14</div>
<div class="crayon-num" data-line="crayon-587b100a4654e314816687-15">15</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4654e314816687-16">16</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a4654e314816687-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">CustomSkipListener</span><span class="crayon-h"> </span><span class="crayon-r">implements</span><span class="crayon-h"> </span><span class="crayon-e">SkipListener</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-2">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-3">
<span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSkipInRead</span><span class="crayon-sy">(</span><span class="crayon-i">Throwable</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-4">
<span class="crayon-h">        </span><span class="crayon-c">// business logic</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-5">
<span class="crayon-h">    </span><span class="crayon-sy">}</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-6"> </div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-7">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-8">
<span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSkipInWrite</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Throwable</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-9">
<span class="crayon-h">        </span><span class="crayon-c">// no need</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-10">
<span class="crayon-h">    </span><span class="crayon-sy">}</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-11"> </div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-12">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-13">
<span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSkipInProcess</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">item</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Throwable</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-14">
<span class="crayon-h">        </span><span class="crayon-c">// no need</span>
</div>
<div class="crayon-line" id="crayon-587b100a4654e314816687-15">
<span class="crayon-h">    </span><span class="crayon-sy">}</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4654e314816687-16"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>而使用annoation的方式可以简写为：</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46554872871848" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class CustomSkipListener {
    @OnSkipInRead
    public void onSkipInRead(Throwable t) {
        // business logic
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46554872871848-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46554872871848-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46554872871848-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46554872871848-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46554872871848-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46554872871848-6">6</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46554872871848-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">CustomSkipListener</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46554872871848-2">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">OnSkipInRead</span>
</div>
<div class="crayon-line" id="crayon-587b100a46554872871848-3">
<span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSkipInRead</span><span class="crayon-sy">(</span><span class="crayon-i">Throwable</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46554872871848-4">
<span class="crayon-h">        </span><span class="crayon-c">// business logic</span>
</div>
<div class="crayon-line" id="crayon-587b100a46554872871848-5">
<span class="crayon-h">    </span><span class="crayon-sy">}</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46554872871848-6"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<h3>使用Retry和Skip增强批处理工作的健壮性</h3>
<p>在处理百万级的数据过程过程中难免会出现异常。如果一旦出现异常而导致整个批处理工作终止的话那么会导致后续的数据无法被处理。Spring Batch内置了Retry（重试）和Skip（跳过）机制帮助我们轻松处理各种异常。我们需要将异常分为三种类型。第一种是需要进行Retry的异常，它们的特点是该异常可能会随着时间推移而消失，比如数据库目前有锁无法写入、web服务当前不可用、web服务满载等。所以对它们适合配置Retry机制。第二种是需要Skip的异常，比如解析文件的某条数据出现异常等，因为对这些异常即使执行Retry每次的结果也都是相同，但又不想由于某条数据出错而停止对后续数据的处理。第三种异常是需要让整个Job立刻失败的异常，比如如果出现了OutOfMemory的异常，那么需要整个Job立刻终止运行。</p>
<p>一般来说需要Retry的异常也要配置Skip选项，从而保证后续的数据能够被继续处理。我们也可以配置SkipLimit选项保证当Skip的数据条目达到一定数量后及时终止整个Job。</p>
<p>有时候我们需要在每次Retry中间隔做一些操作，比如延长Retry时间，恢复操作现场等，Spring Batch提供了BackOffPolicy来达到目的。下面是一个配置了Retry机制、Skip机制以及BackOffPolicy的step示例。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46558361439188" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@Bean
public Step step(){
    return stepBuilders.get("step")
        .chunk(1)
        .reader(reader())
        .processor(processor())
        .writer(writer())
        .listener(logProcessListener())
        .faultTolerant()
        .skipLimit(10)
        .skip(UnknownGenderException.class)
        .skip(ServiceUnavailableException.class)
        .retryLimit(5)
        .retry(ServiceUnavailableException.class)
        .backOffPolicy(backoffPolicy)
        .listener(logSkipListener())
        .build();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46558361439188-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-8">8</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-9">9</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-10">10</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-11">11</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-12">12</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-13">13</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-14">14</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-15">15</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-16">16</div>
<div class="crayon-num" data-line="crayon-587b100a46558361439188-17">17</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46558361439188-18">18</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46558361439188-1">
<span class="crayon-sy">@</span><span class="crayon-e">Bean</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-2">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Step </span><span class="crayon-e">step</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-3">
<span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">stepBuilders</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"step"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-4">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">chunk</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-5">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">reader</span><span class="crayon-sy">(</span><span class="crayon-e">reader</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-6">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">processor</span><span class="crayon-sy">(</span><span class="crayon-e">processor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-7">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">writer</span><span class="crayon-sy">(</span><span class="crayon-e">writer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-8">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">listener</span><span class="crayon-sy">(</span><span class="crayon-e">logProcessListener</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-9">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">faultTolerant</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-10">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">skipLimit</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-11">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">skip</span><span class="crayon-sy">(</span><span class="crayon-v">UnknownGenderException</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-12">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">skip</span><span class="crayon-sy">(</span><span class="crayon-v">ServiceUnavailableException</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-13">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">retryLimit</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-14">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">retry</span><span class="crayon-sy">(</span><span class="crayon-v">ServiceUnavailableException</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-15">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">backOffPolicy</span><span class="crayon-sy">(</span><span class="crayon-v">backoffPolicy</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-16">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">listener</span><span class="crayon-sy">(</span><span class="crayon-e">logSkipListener</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46558361439188-17">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46558361439188-18"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0026 seconds] -->
<p></p>
<h3>使用自定义的Decider来实现Job flow</h3>
<p>在Job执行过程中不一定都是顺序执行的，我们经常需要根据某个job的输出数据或执行结果来决定下一步的走向。以前我们会把一些判断放置在下游step中进行，这样可能会导致有些step实际运行了，但其实并没有做任何事情。比如一个step执行过程中会将失败的数据条目记录到一个报告中，而下一个step会判断有没有生成报告，如果生成了报告则将该报告发送给指定联系人，如果没有则不做任何事情。这种情况下可以通过Decider机制来实现Job的执行流程。在Spring batch 3.0中Decider已经从Step中独立出来，和Step处于同一级别。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a4655c903257119" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class ReportDecider implements JobExecutionDecider {
    @Override
    public FlowExecutionStatus decide(JobExecution jobExecution, StepExecution stepExecution) {
        if (report.isExist()) {
            return new FlowExecutionStatus(“SEND");
        }

        return new FlowExecutionStatus(“SKIP");
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a4655c903257119-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4655c903257119-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a4655c903257119-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4655c903257119-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a4655c903257119-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4655c903257119-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a4655c903257119-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4655c903257119-8">8</div>
<div class="crayon-num" data-line="crayon-587b100a4655c903257119-9">9</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a4655c903257119-10">10</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a4655c903257119-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ReportDecider</span><span class="crayon-h"> </span><span class="crayon-r">implements</span><span class="crayon-h"> </span><span class="crayon-e">JobExecutionDecider</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4655c903257119-2">
<span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span>
</div>
<div class="crayon-line" id="crayon-587b100a4655c903257119-3">
<span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">FlowExecutionStatus </span><span class="crayon-e">decide</span><span class="crayon-sy">(</span><span class="crayon-e">JobExecution </span><span class="crayon-v">jobExecution</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">StepExecution </span><span class="crayon-v">stepExecution</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4655c903257119-4">
<span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">report</span><span class="crayon-sy">.</span><span class="crayon-e">isExist</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line" id="crayon-587b100a4655c903257119-5">
<span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FlowExecutionStatus</span><span class="crayon-sy">(</span>“<span class="crayon-i">SEND</span><span class="crayon-s">");</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4655c903257119-6"><span class="crayon-s">        }</span></div>
<div class="crayon-line" id="crayon-587b100a4655c903257119-7"> </div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4655c903257119-8">
<span class="crayon-s">        return new FlowExecutionStatus(“SKIP"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line" id="crayon-587b100a4655c903257119-9">
<span class="crayon-h">    </span><span class="crayon-sy">}</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a4655c903257119-10"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>而在job配置中可以这样来使用Decider。这样整个Job的执行流程会更加清晰易懂。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46561644919379" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public Job job() {
    return new JobBuilder("petstore")
        .start(orderProcess())
        .next(reportDecider)
        .on("SEND").to(sendReportStep)
        .on("SKIP").end().build()
        .build();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46561644919379-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46561644919379-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46561644919379-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46561644919379-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46561644919379-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46561644919379-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46561644919379-7">7</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46561644919379-8">8</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46561644919379-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Job </span><span class="crayon-e">job</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46561644919379-2">
<span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">JobBuilder</span><span class="crayon-sy">(</span><span class="crayon-s">"petstore"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46561644919379-3">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-e">orderProcess</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46561644919379-4">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-v">reportDecider</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46561644919379-5">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">"SEND"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">to</span><span class="crayon-sy">(</span><span class="crayon-v">sendReportStep</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46561644919379-6">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-s">"SKIP"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46561644919379-7">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46561644919379-8"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p></p>
<h3>采用多种机制加速Job的执行</h3>
<p>批处理工作处理的数据量大，而执行窗口一般又要求比较小。所以必须要通过多种方式来加速Job的执行。一般我们有四种方式来实现：</p>
<ul>
<li>在单个step中多线程执行任务</li>
<li>并行执行不同的Step</li>
<li>并行执行同一个Step</li>
<li>远程执行Chunk任务</li>
</ul>
<p>单个step多线程执行任务可以借助于taskExecutor来实现。这种情况适合于reader、writer是线程安全且是无状态的场景。我们还可以设置线程数量。</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46565504336525" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public Step step() {
    return stepBuilders.get("step")
        .tasklet(tasklet)
        .throttleLimit(20)
        .build();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46565504336525-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46565504336525-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46565504336525-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46565504336525-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46565504336525-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46565504336525-6">6</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46565504336525-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Step </span><span class="crayon-e">step</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46565504336525-2">
<span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">stepBuilders</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"step"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46565504336525-3">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">tasklet</span><span class="crayon-sy">(</span><span class="crayon-v">tasklet</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46565504336525-4">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">throttleLimit</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46565504336525-5">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46565504336525-6"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>上述示例中的tasklet需要实现TaskExecutor，Spring Batch提供了一个简单的多线程TaskExecutor供我们使用：SimpleAsyncTaskExecutor。</p>
<p>并行执行不同的Step在Spring batch中很容易实现，以下是一个示例：</p>
<!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-587b100a46568025032934" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" touchscreen minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">

			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;">
<div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div>
<div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div>
</div>
</div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public Job job() {
    return stepBuilders.get("parallelSteps")
        .start(step1)
        .split(asyncTaskExecutor).add(flow1, flow2)
        .next(step3)
        .build();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;">
<div class="crayon-num" data-line="crayon-587b100a46568025032934-1">1</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46568025032934-2">2</div>
<div class="crayon-num" data-line="crayon-587b100a46568025032934-3">3</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46568025032934-4">4</div>
<div class="crayon-num" data-line="crayon-587b100a46568025032934-5">5</div>
<div class="crayon-num crayon-striped-num" data-line="crayon-587b100a46568025032934-6">6</div>
<div class="crayon-num" data-line="crayon-587b100a46568025032934-7">7</div>
</div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
<div class="crayon-line" id="crayon-587b100a46568025032934-1">
<span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Job </span><span class="crayon-e">job</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46568025032934-2">
<span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">stepBuilders</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"parallelSteps"</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46568025032934-3">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-v">step1</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46568025032934-4">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">asyncTaskExecutor</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">flow1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flow2</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line" id="crayon-587b100a46568025032934-5">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-v">step3</span><span class="crayon-sy">)</span>
</div>
<div class="crayon-line crayon-striped-line" id="crayon-587b100a46568025032934-6">
<span class="crayon-h">        </span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span>
</div>
<div class="crayon-line" id="crayon-587b100a46568025032934-7"><span class="crayon-sy">}</span></div>
</div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>在这个示例中我们先执行step1，然后并行执行flow1和flow2，最后再执行step3。</p>
<p>Spring batch提供了PartitionStep来实现对同一个step在多个进程中实现并行处理。通过PartitonStep再配合PartitionHandler可以将一个step扩展到多个Slave上实现并行运行。</p>
<p>远程执行Chunk任务则是将某个Step的processer操作分割到多个进程中，多个进程通过一些中间件进行通讯（比如采用消息的方式）。这种方式适合于Processer是瓶颈而Reader和Writer不是瓶颈的场景。</p>
<h2>结语</h2>
<p>Spring Batch对批处理场景进行了合理的抽象，封装了大量的实用功能，使用它来开发批处理应用可以达到事半功倍的效果。在使用的过程中我们仍需要坚持总结一些最佳实践，从而能够交付高质量的可维护的批处理应用，满足企业级应用的苛刻要求。</p>

    <div class="post-adds">
        <span data-post-id="109857" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="109857votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="109857" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i>  收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>

        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>

        <!-- BEGIN #author-bio -->

<div id="author-bio">

	<h3 class="widget-title">
	关于作者：<a target="_blank" href="http://www.jobbole.com/members/thoughtworkschina">ThoughtWorks</a>
	</h3>
	<div class="alignleft">
		<a target="_blank" href="http://www.jobbole.com/members/thoughtworkschina">
			<img src="/images/jobbole.com/8a86f1338baa47a6e6bd4a03d41e36e6.jpg">
		</a>
	</div>

    <div class="author-bio-info">

        <span class="author-bio-info-block">
            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，为客户提供注重实效的咨询服务（IT组织优化、技术咨询、测试策略、客户体验）。同时我们也擅长构建定制化系统和产品，帮助客户快速将概念转化为价值。 我们满怀信心和激情，不断推动敏捷在中国IT业的推广和应用，提升中国软件开发的生产力。        </span>
        <span class="author-bio-info-block">
            <a href="http://www.jobbole.com/members/thoughtworkschina" target="_blank"><i class="fa fa-user"></i> 个人主页</a> ·
            <a href="http://blog.jobbole.com/author/thoughtworkschina/" target="_blank"><i class="fa fa-file-text-o"></i> 我的文章</a>

             · <a title="声望值" target="_blank" href="http://www.jobbole.com/members/thoughtworkschina/reputation/"><i class="fa fa-graduation-cap"></i> 30</a> · <a title="我的网站" target="_blank" href="http://insights.thoughtworkers.org/"><i class="fa fa-link"></i></a> <a title="微博主页" target="_blank" href="http://weibo.com/thoughtworkschina"><i class="fa fa-weibo"></i></a>         </span>
    </div>
	<div class="clear"></div>
</div>

<!-- END #author-bio -->

  </article>

  <div class="meta">

    <a class="basic-alignment left" href="/posts/2017/2017-01-13-109852-1711887c9.html" title="Previous Post: 我是如何开发公司年会抽奖系统的？" data-instant>&laquo; 我是如何开发公司年会抽奖系统的？</a>

    <a class="basic-alignment right" href="/posts/2017/2017-01-14-109770-25657024a.html" title="Next Post: 谷歌大脑 2016 年机器学习的 9 大进展" data-instant>谷歌大脑 2016 年机器学习的 9 大进展 &raquo;</a>

</div>
  <div id="related">
  <h2 class="subheader">Related Posts <small>They might be useful</small></h2>
  <ul class="posts">

      <li><span>23 Jan 2017</span> &raquo; <a href="http://iftti.com/posts/2017/2017-01-23-109970-be7a95583.html">每天一个 Linux 命令（46）： vmstat 命令</a></li>

      <li><span>22 Jan 2017</span> &raquo; <a href="http://iftti.com/posts/2017/2017-01-22-109965-c5dfb9397.html">每天一个 Linux 命令（45）： free 命令</a></li>

      <li><span>21 Jan 2017</span> &raquo; <a href="http://iftti.com/posts/2017/2017-01-21-109951-09f1179a7.html">每天一个 Linux 命令（44）： top 命令</a></li>

  </ul>
</div>

<comments>

<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1936498"></script>
<!-- UY END -->

</comments>

</div>
      <!-- JiaThis Button BEGIN -->
<div class="jiathis_share_slide jiathis_share_24x24" id="jiathis_share_slide">
<div class="jiathis_share_slide_top" id="jiathis_share_title"></div>
<div class="jiathis_share_slide_inner">
<div class="jiathis_style_24x24">
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_googleplus"></a>
<a class="jiathis_button_twitter"></a>
<a class="jiathis_button_linkedin"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_cqq"></a>
<a class="jiathis_button_renren"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_pocket"></a>
<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'
	,slide:{
		divid:'wrap',
		pos:'left',
		gt:'true'
	}
};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1936498" charset="utf-8"></script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_slide.js" charset="utf-8"></script>
</div></div></div>
<!-- JiaThis Button END -->
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading">IT技术干货</h2>

    <div class="footer-col-1 column">
      <p class="text">[IT技术干货iftti.com] @KernelHacks</p>
      <ul>
        <li>科技与互联网信息</li>
        <li>Liu Lantao</li>
        <li><a href="mailto:iftti@iftti.com">iftti@iftti.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/Lax">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">Lax</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/liulantao">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">@liulantao</span>
          </a>
        </li>
        <li>
          <a href="https://plus.google.com/+LiuLantao">
            <span class="icon googleplus">
              <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                width="16px" height="16px" viewBox="0 0 134.658 131.646" enable-background="new 0 0 134.658 131.646"
                xml:space="preserve">
                <g>
                  <path fill="#C2C2C2" d="M126.515,4.109H8.144c-2.177,0-3.94,1.763-3.94,3.938v115.546c0,2.179,1.763,3.942,3.94,3.942h118.371
                  c2.177,0,3.94-1.764,3.94-3.942V8.048C130.455,5.872,128.691,4.109,126.515,4.109z"/>
                  <g>
                    <path fill="#FFFFFF" d="M70.479,71.845l-3.983-3.093c-1.213-1.006-2.872-2.334-2.872-4.765c0-2.441,1.659-3.993,3.099-5.43
                    c4.64-3.652,9.276-7.539,9.276-15.73c0-8.423-5.3-12.854-7.84-14.956h6.849l7.189-4.517H60.418
                    c-5.976,0-14.588,1.414-20.893,6.619c-4.752,4.1-7.07,9.753-7.07,14.842c0,8.639,6.633,17.396,18.346,17.396
                    c1.106,0,2.316-0.109,3.534-0.222c-0.547,1.331-1.1,2.439-1.1,4.32c0,3.431,1.763,5.535,3.317,7.528
                    c-4.977,0.342-14.268,0.893-21.117,5.103c-6.523,3.879-8.508,9.525-8.508,13.51c0,8.202,7.731,15.842,23.762,15.842
                    c19.01,0,29.074-10.519,29.074-20.932C79.764,79.709,75.344,75.943,70.479,71.845z M56,59.107
                    c-9.51,0-13.818-12.294-13.818-19.712c0-2.888,0.547-5.87,2.428-8.199c1.773-2.218,4.861-3.657,7.744-3.657
                    c9.168,0,13.923,12.404,13.923,20.382c0,1.996-0.22,5.533-2.762,8.09C61.737,57.785,58.762,59.107,56,59.107z M56.109,103.65
                    c-11.826,0-19.452-5.657-19.452-13.523c0-7.864,7.071-10.524,9.504-11.405c4.64-1.561,10.611-1.779,11.607-1.779
                    c1.105,0,1.658,0,2.538,0.111c8.407,5.983,12.056,8.965,12.056,14.629C72.362,98.542,66.723,103.65,56.109,103.65z"/>
                    <polygon fill="#FFFFFF" points="98.393,58.938 98.393,47.863 92.923,47.863 92.923,58.938 81.866,58.938 81.866,64.469
                    92.923,64.469 92.923,75.612 98.393,75.612 98.393,64.469 109.506,64.469 109.506,58.938"/>
                  </g>
                </g>
              </svg>
            </span>
            <span class="username">+LiuLantao</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">

<!--以下是QQ邮件列表订阅嵌入代码--><script >var nId = "6be92ef3590ee662cd5e6381ab2044c328716364f684cf3e",nWidth="auto",sColor="light",sText="填写您的邮件地址，订阅我们的精彩内容：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>

    </div>

  </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1658815-7', 'iftti.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

</footer>

    </body>
</html>